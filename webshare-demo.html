<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Web Share API Demo</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #0f0f13;
      color: #e4e4f0;
      min-height: 100vh;
      padding: 2rem 1rem;
    }

    header {
      max-width: 700px;
      margin: 0 auto 2.5rem;
      text-align: center;
    }

    header h1 {
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(135deg, #a78bfa, #60a5fa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }

    header p {
      color: #888;
      font-size: 0.95rem;
    }

    .support-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      margin-top: 0.75rem;
      padding: 0.3rem 0.8rem;
      border-radius: 99px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .support-badge.supported   { background: #14532d; color: #86efac; }
    .support-badge.unsupported { background: #450a0a; color: #fca5a5; }

    .dot { width: 8px; height: 8px; border-radius: 50%; background: currentColor; }

    /* ── Table of contents ── */
    .toc {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      justify-content: center;
      max-width: 900px;
      margin: 0 auto 2rem;
      padding: 0 0.25rem;
    }

    .toc a {
      display: inline-block;
      padding: 0.3rem 0.75rem;
      border-radius: 99px;
      font-size: 0.78rem;
      font-weight: 600;
      text-decoration: none;
      background: #1a1a24;
      border: 1px solid #2a2a38;
      color: #a5b4fc;
      white-space: nowrap;
      transition: background 0.15s, border-color 0.15s;
    }

    .toc a:hover { background: #252535; border-color: #4a4a68; }

    /* ── Card grid ── */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.25rem;
      max-width: 900px;
      margin: 0 auto;
    }

    .card {
      background: #1a1a24;
      border: 1px solid #2a2a38;
      border-radius: 1rem;
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .card-title {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #666;
    }

    .card h2 {
      font-size: 1.1rem;
      font-weight: 600;
      color: #e4e4f0;
    }

    .card p {
      font-size: 0.85rem;
      color: #888;
      line-height: 1.5;
    }

    /* ── Share buttons ── */
    .share-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      width: 100%;
      padding: 0.65rem 1rem;
      border: none;
      border-radius: 0.6rem;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.15s, transform 0.1s;
      color: #fff;
      text-decoration: none;
    }

    .share-btn:hover  { opacity: 0.88; }
    .share-btn:active { transform: scale(0.97); }
    .share-btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; }

    .btn-native   { background: #7c3aed; }
    .btn-twitter  { background: #000; }
    .btn-facebook { background: #1877f2; }
    .btn-linkedin { background: #0a66c2; }
    .btn-whatsapp { background: #25d366; color: #111; }
    .btn-telegram { background: #2ca5e0; }
    .btn-email    { background: #374151; }
    .btn-reddit   { background: #ff4500; }
    .btn-copy      { background: #1e293b; border: 1px solid #334155; }
    .btn-instagram { background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); }
    .btn-tiktok    { background: #010101; border: 1px solid #333; }

    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    /* ── Result toast ── */
    #toast {
      position: fixed;
      bottom: 1.5rem;
      left: 50%;
      transform: translateX(-50%) translateY(80px);
      background: #1e293b;
      border: 1px solid #334155;
      color: #e4e4f0;
      padding: 0.6rem 1.2rem;
      border-radius: 0.6rem;
      font-size: 0.85rem;
      font-weight: 500;
      transition: transform 0.25s ease;
      pointer-events: none;
      white-space: nowrap;
      z-index: 999;
    }

    #toast.show { transform: translateX(-50%) translateY(0); }

    /* ── Payload editor ── */
    .payload-editor {
      background: #11111a;
      border: 1px solid #2a2a38;
      border-radius: 0.6rem;
      padding: 1rem;
    }

    .payload-editor label {
      display: block;
      font-size: 0.75rem;
      font-weight: 600;
      color: #666;
      margin-bottom: 0.35rem;
    }

    .payload-editor input,
    .payload-editor textarea {
      width: 100%;
      background: #1a1a24;
      border: 1px solid #2a2a38;
      border-radius: 0.4rem;
      color: #e4e4f0;
      font-size: 0.85rem;
      padding: 0.45rem 0.6rem;
      margin-bottom: 0.6rem;
      resize: vertical;
    }

    .payload-editor input:focus,
    .payload-editor textarea:focus {
      outline: 2px solid #7c3aed;
      outline-offset: -2px;
    }

    /* ── Feature list ── */
    .feature-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .feature-list li {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.83rem;
      color: #aaa;
    }

    .check { color: #4ade80; font-size: 0.9rem; }
    .cross { color: #f87171; font-size: 0.9rem; }

    /* ── Code block ── */
    pre {
      background: #11111a;
      border: 1px solid #2a2a38;
      border-radius: 0.5rem;
      padding: 0.85rem;
      font-size: 0.75rem;
      color: #a5b4fc;
      overflow-x: auto;
      line-height: 1.6;
      white-space: pre;
    }
  </style>
</head>
<body>

<header>
  <h1>Web Share API Demo</h1>
  <p>Explore native device sharing alongside social media fallbacks</p>
  <span id="support-badge" class="support-badge unsupported">
    <span class="dot"></span> Checking support…
  </span>
</header>

<nav class="toc" aria-label="Jump to section">
  <a href="#card-native">Native Share</a>
  <a href="#card-can-share">canShare()</a>
  <a href="#card-file">Share File</a>
  <a href="#card-video">Share Video</a>
  <a href="#card-twitter">Twitter / X</a>
  <a href="#card-facebook">Facebook</a>
  <a href="#card-linkedin">LinkedIn</a>
  <a href="#card-whatsapp">WhatsApp</a>
  <a href="#card-telegram">Telegram</a>
  <a href="#card-instagram">Instagram</a>
  <a href="#card-tiktok">TikTok</a>
  <a href="#card-email">Email</a>
  <a href="#card-copy">Copy Link</a>
  <a href="#card-smart">Smart Share</a>
</nav>

<div class="grid">

  <!-- ── 1. Native Share (navigator.share) ── -->
  <div class="card" id="card-native">
    <span class="card-title">Feature 1</span>
    <h2>Native Share Sheet</h2>
    <p>Invokes the OS-level share sheet — apps available depend on what's installed on the device.</p>

    <div class="payload-editor">
      <label for="share-title">Title</label>
      <input id="share-title" type="text" value="Check out the Web Share API!" />

      <label for="share-text">Text</label>
      <textarea id="share-text" rows="2">A powerful browser API for triggering native sharing.</textarea>

      <label for="share-url">URL</label>
      <input id="share-url" type="url" value="https://developer.mozilla.org/en-US/docs/Web/API/Web_Share_API" />
    </div>

    <div class="btn-group">
      <button id="btn-native" class="share-btn btn-native" onclick="shareNative()">
        &#x2197;&#xFE0F; Share via Device
      </button>
    </div>
  </div>

  <!-- ── 2. canShare() capability check ── -->
  <div class="card" id="card-can-share">
    <span class="card-title">Feature 2</span>
    <h2>canShare() Check</h2>
    <p>Use <code>navigator.canShare()</code> before calling <code>navigator.share()</code> to verify the payload is shareable.</p>

    <ul class="feature-list" id="can-share-results">
      <li><span class="check">?</span> Text + URL payload</li>
      <li><span class="check">?</span> Files payload (image)</li>
      <li><span class="check">?</span> Files payload (video)</li>
      <li><span class="check">?</span> Files payload (PDF)</li>
    </ul>

    <button class="share-btn btn-copy" onclick="runCanShareChecks()">Run canShare() Checks</button>
  </div>

  <!-- ── 3. File sharing ── -->
  <div class="card" id="card-file">
    <span class="card-title">Feature 3</span>
    <h2>Share a File</h2>
    <p>Pick a local file and share it using the Web Share API — requires browser + OS support for file sharing.</p>

    <div class="payload-editor">
      <label for="file-input">Choose file</label>
      <input id="file-input" type="file" onchange="onFileSelected()" />
      <button id="btn-file-sample" class="share-btn btn-copy" onclick="loadFileSample()" style="margin-top:0.35rem;">
        &#x1F5BC;&#xFE0F; Use sample image
      </button>
    </div>

    <img id="file-preview" style="display:none; width:100%; border-radius:0.5rem; object-fit:contain; max-height:180px; background:#11111a;" alt="Preview" />

    <button class="share-btn btn-native" onclick="shareFile()">&#x1F4CE; Share File</button>
  </div>

  <!-- ── 4. Video sharing ── -->
  <div class="card" id="card-video">
    <span class="card-title">Feature 4</span>
    <h2>Share a Video</h2>
    <p>Pick a local video file, preview it, then share via the Web Share API — or fall back to a download link.</p>

    <div class="payload-editor">
      <label for="video-input">Choose video</label>
      <input id="video-input" type="file" accept="video/*" onchange="onVideoSelected()" />
      <button id="btn-video-sample" class="share-btn btn-copy" onclick="loadVideoSample()" style="margin-top:0.35rem;">
        &#x1F3A5; Use sample video
      </button>
    </div>

    <video id="video-preview" controls style="display:none; width:100%; border-radius:0.5rem; background:#000; max-height:180px;"></video>

    <div class="btn-group">
      <button id="btn-share-video" class="share-btn btn-native" onclick="shareVideo()" disabled>&#x1F3A5; Share Video</button>
      <a id="btn-download-video" class="share-btn btn-copy" style="display:none;" download>&#x2B07;&#xFE0F; Download (fallback)</a>
    </div>
  </div>

  <!-- ── 6. Twitter / X ── -->
  <div class="card" id="card-twitter">
    <span class="card-title">Fallback — Twitter / X</span>
    <h2>Share to Twitter</h2>
    <p>Opens Twitter's Web Intent, pre-filled with text and URL. Works on all browsers.</p>

    <button class="share-btn btn-twitter" onclick="shareTwitter()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-4.714-6.231-5.401 6.231H2.748l7.73-8.835L1.254 2.25H8.08l4.254 5.622 5.91-5.622zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
      Share to X / Twitter
    </button>
  </div>

  <!-- ── 5. Facebook ── -->
  <div class="card" id="card-facebook">
    <span class="card-title">Fallback — Facebook</span>
    <h2>Share to Facebook</h2>
    <p>Opens Facebook's sharer dialog with the current demo URL. No app ID required for basic sharing.</p>

    <button class="share-btn btn-facebook" onclick="shareFacebook()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
      Share to Facebook
    </button>
  </div>

  <!-- ── 6. LinkedIn ── -->
  <div class="card" id="card-linkedin">
    <span class="card-title">Fallback — LinkedIn</span>
    <h2>Share to LinkedIn</h2>
    <p>Opens LinkedIn's share dialog with a pre-filled URL. Ideal for professional content sharing.</p>

    <button class="share-btn btn-linkedin" onclick="shareLinkedIn()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
      Share to LinkedIn
    </button>
  </div>

  <!-- ── 7. WhatsApp ── -->
  <div class="card" id="card-whatsapp">
    <span class="card-title">Fallback — WhatsApp</span>
    <h2>Share to WhatsApp</h2>
    <p>Opens WhatsApp with a pre-composed message. Works in both the desktop and mobile apps.</p>

    <button class="share-btn btn-whatsapp" onclick="shareWhatsApp()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
      Share to WhatsApp
    </button>
  </div>

  <!-- ── 8. Telegram ── -->
  <div class="card" id="card-telegram">
    <span class="card-title">Fallback — Telegram</span>
    <h2>Share to Telegram</h2>
    <p>Opens Telegram's share dialog via the <code>t.me/share/url</code> endpoint.</p>

    <button class="share-btn btn-telegram" onclick="shareTelegram()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
      Share to Telegram
    </button>
  </div>

  <!-- ── 9. Reddit ── -->
  <div class="card">
    <span class="card-title">Fallback — Reddit</span>
    <h2>Share to Reddit</h2>
    <p>Opens Reddit's submit page pre-filled with the title and URL for posting to a community.</p>

    <button class="share-btn btn-reddit" onclick="shareReddit()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
      Share to Reddit
    </button>
  </div>

  <!-- ── 9b. Instagram ── -->
  <div class="card" id="card-instagram">
    <span class="card-title">Fallback — Instagram</span>
    <h2>Share to Instagram</h2>
    <p>Instagram has no web share URL. On mobile, pick an <strong>MP4</strong> video to share via the native sheet (WebM is not supported by Instagram), or share the link. On desktop, the link is copied and Instagram opens.</p>

    <div class="payload-editor">
      <label for="instagram-video-input">Image or video (optional)</label>
      <input id="instagram-video-input" type="file" accept="image/*,video/*" onchange="onInstagramVideoSelected()" />
      <div style="display:flex; gap:0.4rem; margin-top:0.35rem;">
        <button id="btn-instagram-img-sample" class="share-btn btn-copy" onclick="loadInstagramImageSample()" style="flex:1;">
          &#x1F5BC;&#xFE0F; Sample image
        </button>
        <button id="btn-instagram-sample" class="share-btn btn-copy" onclick="loadInstagramSample()" style="flex:1;">
          &#x1F3A5; Sample video
        </button>
      </div>
    </div>

    <img id="instagram-img-preview" style="display:none; width:100%; border-radius:0.5rem; object-fit:contain; max-height:160px; background:#11111a;" alt="Preview" />
    <video id="instagram-video-preview" controls style="display:none; width:100%; border-radius:0.5rem; background:#000; max-height:160px;"></video>

    <button class="share-btn btn-instagram" onclick="shareInstagram()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>
      Share to Instagram
    </button>
  </div>

  <!-- ── 9c. TikTok ── -->
  <div class="card" id="card-tiktok">
    <span class="card-title">Fallback — TikTok</span>
    <h2>Share to TikTok</h2>
    <p>TikTok has no web share URL. On mobile, pick a video to share via the native sheet, or share the link. On desktop, the link is copied and TikTok opens.</p>

    <div class="payload-editor">
      <label for="tiktok-video-input">Image or video (optional)</label>
      <input id="tiktok-video-input" type="file" accept="image/*,video/*" onchange="onTikTokVideoSelected()" />
      <div style="display:flex; gap:0.4rem; margin-top:0.35rem;">
        <button id="btn-tiktok-img-sample" class="share-btn btn-copy" onclick="loadTikTokImageSample()" style="flex:1;">
          &#x1F5BC;&#xFE0F; Sample image
        </button>
        <button id="btn-tiktok-sample" class="share-btn btn-copy" onclick="loadTikTokSample()" style="flex:1;">
          &#x1F3A5; Sample video
        </button>
      </div>
    </div>

    <img id="tiktok-img-preview" style="display:none; width:100%; border-radius:0.5rem; object-fit:contain; max-height:160px; background:#11111a;" alt="Preview" />
    <video id="tiktok-video-preview" controls style="display:none; width:100%; border-radius:0.5rem; background:#000; max-height:160px;"></video>

    <button class="share-btn btn-tiktok" onclick="shareTikTok()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-2.88 2.5 2.89 2.89 0 01-2.89-2.89 2.89 2.89 0 012.89-2.89c.28 0 .54.04.79.1V9.01a6.33 6.33 0 00-.79-.05 6.34 6.34 0 00-6.34 6.34 6.34 6.34 0 006.34 6.34 6.34 6.34 0 006.33-6.34V8.69a8.18 8.18 0 004.79 1.53V6.77a4.85 4.85 0 01-1.02-.08z"/></svg>
      Share to TikTok
    </button>
  </div>

  <!-- ── 10. Email ── -->
  <div class="card" id="card-email">
    <span class="card-title">Fallback — Email</span>
    <h2>Share via Email</h2>
    <p>Opens the default mail client with a pre-filled subject and body — zero dependencies.</p>

    <button class="share-btn btn-email" onclick="shareEmail()">
      &#x2709;&#xFE0F; Share via Email
    </button>
  </div>

  <!-- ── 11. Copy to clipboard ── -->
  <div class="card" id="card-copy">
    <span class="card-title">Utility</span>
    <h2>Copy Link to Clipboard</h2>
    <p>Uses the Clipboard API as a silent share fallback when no native share is available.</p>

    <button class="share-btn btn-copy" onclick="copyToClipboard()">&#x1F4CB; Copy Link</button>
  </div>

  <!-- ── 12. Smart share ── -->
  <div class="card" id="card-smart">
    <span class="card-title">Best Practice</span>
    <h2>Smart Share (with Fallback)</h2>
    <p>Tries <code>navigator.share()</code> first; falls back to a custom share menu if the API is unavailable.</p>

    <button class="share-btn btn-native" onclick="smartShare()">&#x1F517; Smart Share</button>

    <div id="fallback-menu" style="display:none; margin-top:0.5rem;">
      <div class="btn-group">
        <button class="share-btn btn-twitter"   onclick="shareTwitter()">X / Twitter</button>
        <button class="share-btn btn-facebook"  onclick="shareFacebook()">Facebook</button>
        <button class="share-btn btn-instagram" onclick="shareInstagram()">Instagram</button>
        <button class="share-btn btn-tiktok"    onclick="shareTikTok()">TikTok</button>
        <button class="share-btn btn-linkedin"  onclick="shareLinkedIn()">LinkedIn</button>
        <button class="share-btn btn-whatsapp"  onclick="shareWhatsApp()">WhatsApp</button>
        <button class="share-btn btn-email"     onclick="shareEmail()">Email</button>
        <button class="share-btn btn-copy"      onclick="copyToClipboard()">Copy Link</button>
      </div>
    </div>
  </div>

  <!-- ── 13. Code snippet ── -->
  <div class="card" style="grid-column: 1 / -1;">
    <span class="card-title">Reference</span>
    <h2>Minimal Implementation</h2>
    <pre>// Basic share
await navigator.share({
  title: 'Hello Web Share!',
  text:  'Check this out',
  url:   'https://example.com',
});

// Guard with canShare()
const data = { title, text, url };
if (navigator.canShare?.(data)) {
  await navigator.share(data);
}

// File sharing (image)
const file = new File([blob], 'image.png', { type: 'image/png' });
if (navigator.canShare?.({ files: [file] })) {
  await navigator.share({ files: [file], title: 'My image' });
}

// Video sharing
const [videoFile] = videoInput.files;
if (navigator.canShare?.({ files: [videoFile] })) {
  await navigator.share({ files: [videoFile], title: videoFile.name });
}</pre>
  </div>

</div>

<div id="toast"></div>

<script>
  // ── Helpers ──────────────────────────────────────────────────────────

  function getPayload() {
    return {
      title: document.getElementById('share-title').value,
      text:  document.getElementById('share-text').value,
      url:   document.getElementById('share-url').value,
    };
  }

  function toast(msg, duration = 2800) {
    const el = document.getElementById('toast');
    el.textContent = msg;
    el.classList.add('show');
    clearTimeout(toast._t);
    toast._t = setTimeout(() => el.classList.remove('show'), duration);
  }

  function openPopup(url) {
    window.open(url, '_blank', 'width=600,height=480,noopener,noreferrer');
  }

  // ── Support badge ────────────────────────────────────────────────────

  const badge = document.getElementById('support-badge');
  const nativeBtn = document.getElementById('btn-native');

  if ('share' in navigator) {
    badge.className = 'support-badge supported';
    badge.innerHTML = '<span class="dot"></span> navigator.share() supported';
  } else {
    badge.className = 'support-badge unsupported';
    badge.innerHTML = '<span class="dot"></span> navigator.share() not supported in this browser';
    nativeBtn.disabled = true;
  }

  // ── Feature 1 — Native share ─────────────────────────────────────────

  async function shareNative() {
    try {
      await navigator.share(getPayload());
      toast('✓ Shared successfully');
    } catch (err) {
      if (err.name !== 'AbortError') toast('Share failed: ' + err.message);
    }
  }

  // ── Feature 2 — canShare() checks ───────────────────────────────────

  function runCanShareChecks() {
    const items = document.querySelectorAll('#can-share-results li');
    const supportsCanShare = 'canShare' in navigator;

    const textUrlOk = supportsCanShare && navigator.canShare({ title: 'Test', url: 'https://example.com' });

    const dummyImageFile = new File([''], 'test.png', { type: 'image/png' });
    const imageOk = supportsCanShare && navigator.canShare({ files: [dummyImageFile] });

    const dummyVideoFile = new File([''], 'test.mp4', { type: 'video/mp4' });
    const videoOk = supportsCanShare && navigator.canShare({ files: [dummyVideoFile] });

    const dummyPdfFile = new File([''], 'test.pdf', { type: 'application/pdf' });
    const pdfOk = supportsCanShare && navigator.canShare({ files: [dummyPdfFile] });

    const results = [textUrlOk, imageOk, videoOk, pdfOk];
    const labels  = ['Text + URL payload', 'Files payload (image)', 'Files payload (video)', 'Files payload (PDF)'];

    items.forEach((li, i) => {
      const ok = results[i];
      li.innerHTML = `<span class="${ok ? 'check' : 'cross'}">${ok ? '✓' : '✗'}</span> ${labels[i]}`;
    });

    toast(supportsCanShare ? '✓ canShare() checks complete' : '✗ canShare() not supported');
  }

  // ── Feature 3 — File share ───────────────────────────────────────────

  let feature3FileRef = null;

  function generateSampleImage(label, colors, platformName) {
    return new Promise((resolve, reject) => {
      const canvas = document.createElement('canvas');
      canvas.width = 800; canvas.height = 800;
      const ctx = canvas.getContext('2d');

      const grad = ctx.createLinearGradient(0, 0, 800, 800);
      colors.forEach((c, i) => grad.addColorStop(i / (colors.length - 1), c));
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, 800, 800);

      // Decorative circles
      [[400, 300, 140], [400, 300, 100], [400, 300, 60]].forEach(([x, y, r], i) => {
        ctx.beginPath();
        ctx.arc(x, y, r, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255,255,255,${0.08 + i * 0.07})`;
        ctx.fill();
      });

      ctx.fillStyle = '#fff';
      ctx.textAlign = 'center';
      ctx.font = 'bold 52px -apple-system, sans-serif';
      ctx.fillText(platformName, 400, 500);
      ctx.font = '30px -apple-system, sans-serif';
      ctx.fillStyle = 'rgba(255,255,255,0.8)';
      ctx.fillText('Web Share API Demo', 400, 555);

      canvas.toBlob(blob => {
        if (!blob) { reject(new Error('Canvas toBlob failed')); return; }
        resolve(new File([blob], `${label}.png`, { type: 'image/png' }));
      }, 'image/png');
    });
  }

  async function loadFileSample() {
    const btn = document.getElementById('btn-file-sample');
    btn.disabled = true;
    btn.textContent = 'Generating…';
    try {
      feature3FileRef = await generateSampleImage('sample-image',
        ['#7c3aed', '#60a5fa', '#a78bfa', '#60a5fa'], 'Sample Image');
      const preview = document.getElementById('file-preview');
      preview.src = URL.createObjectURL(feature3FileRef);
      preview.style.display = 'block';
      btn.textContent = '✓ Sample loaded';
    } catch (err) {
      toast('Could not generate sample: ' + err.message);
      btn.disabled = false;
      btn.innerHTML = '&#x1F5BC;&#xFE0F; Use sample image';
    }
  }

  function onFileSelected() {
    const file = document.getElementById('file-input').files[0];
    const preview = document.getElementById('file-preview');
    feature3FileRef = file || null;
    const sampleBtn = document.getElementById('btn-file-sample');
    sampleBtn.disabled = false;
    sampleBtn.innerHTML = '&#x1F5BC;&#xFE0F; Use sample image';

    if (file && file.type.startsWith('image/')) {
      preview.src = URL.createObjectURL(file);
      preview.style.display = 'block';
    } else {
      preview.style.display = 'none';
      preview.src = '';
    }
  }

  async function shareFile() {
    const file = feature3FileRef || document.getElementById('file-input').files[0];

    if (!file) { toast('Please select a file first'); return; }

    if (!navigator.canShare?.({ files: [file] })) {
      toast('File sharing not supported for this file type or browser');
      return;
    }

    try {
      await navigator.share({ files: [file], title: file.name });
      toast('✓ File shared');
    } catch (err) {
      if (err.name !== 'AbortError') toast('Share failed: ' + err.message);
    }
  }

  // ── Feature 4 — Video share ──────────────────────────────────────────

  let feature4VideoFile = null;

  function _showVideoFile(file, videoEl, shareBtn, dlBtn) {
    const objectUrl = URL.createObjectURL(file);
    videoEl.src = objectUrl;
    videoEl.style.display = 'block';
    if (dlBtn) { dlBtn.href = objectUrl; dlBtn.download = file.name; dlBtn.style.display = 'inline-flex'; }
    if (shareBtn) shareBtn.disabled = !navigator.canShare?.({ files: [file] });
  }

  function onVideoSelected() {
    const file = document.getElementById('video-input').files[0];
    feature4VideoFile = file || null;
    const sampleBtn = document.getElementById('btn-video-sample');
    sampleBtn.disabled = false;
    sampleBtn.innerHTML = '&#x1F3A5; Use sample video';
    if (!file) return;
    _showVideoFile(file,
      document.getElementById('video-preview'),
      document.getElementById('btn-share-video'),
      document.getElementById('btn-download-video'));
  }

  async function loadVideoSample() {
    const btn = document.getElementById('btn-video-sample');
    btn.disabled = true;
    btn.textContent = 'Generating…';
    try {
      feature4VideoFile = await generateSampleVideo('sample-video',
        ['#7c3aed','#60a5fa','#a78bfa','#60a5fa'], 'Sample Video');
      _showVideoFile(feature4VideoFile,
        document.getElementById('video-preview'),
        document.getElementById('btn-share-video'),
        document.getElementById('btn-download-video'));
      btn.textContent = '✓ Sample loaded';
    } catch (err) {
      toast('Could not generate sample: ' + err.message);
      btn.disabled = false;
      btn.innerHTML = '&#x1F3A5; Use sample video';
    }
  }

  async function shareVideo() {
    const file = feature4VideoFile || document.getElementById('video-input').files[0];
    if (!file) { toast('Please select a video first'); return; }

    if (!navigator.canShare?.({ files: [file] })) {
      toast('Video file sharing not supported in this browser');
      return;
    }

    try {
      await navigator.share({ files: [file], title: file.name });
      toast('✓ Video shared');
    } catch (err) {
      if (err.name !== 'AbortError') toast('Share failed: ' + err.message);
    }
  }

  // ── Social fallbacks ─────────────────────────────────────────────────

  function shareTwitter() {
    const { text, url } = getPayload();
    openPopup(`https://x.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`);
  }

  function shareFacebook() {
    const { url } = getPayload();
    openPopup(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`);
  }

  function shareLinkedIn() {
    const { url } = getPayload();
    openPopup(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`);
  }

  function shareWhatsApp() {
    const { text, url } = getPayload();
    openPopup(`https://api.whatsapp.com/send?text=${encodeURIComponent(text + ' ' + url)}`);
  }

  function shareTelegram() {
    const { text, url } = getPayload();
    openPopup(`https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`);
  }

  function shareReddit() {
    const { title, url } = getPayload();
    openPopup(`https://www.reddit.com/submit?title=${encodeURIComponent(title)}&url=${encodeURIComponent(url)}`);
  }

  // Stored reference for sample-generated video (bypasses file input)
  let instagramVideoFile = null;
  let tiktokVideoFile = null;

  function generateSampleVideo(label, colors, platformName) {
    return new Promise((resolve, reject) => {
      const canvas = document.createElement('canvas');
      canvas.width = 480; canvas.height = 480;
      const ctx = canvas.getContext('2d');

      const mimeType = ['video/webm;codecs=vp9', 'video/webm;codecs=vp8', 'video/webm', 'video/mp4']
        .find(t => MediaRecorder.isTypeSupported(t));
      if (!mimeType) { reject(new Error('MediaRecorder not supported')); return; }

      const stream = canvas.captureStream(30);
      const recorder = new MediaRecorder(stream, { mimeType });
      const chunks = [];

      recorder.ondataavailable = e => { if (e.data.size) chunks.push(e.data); };
      recorder.onstop = () => {
        const ext = mimeType.startsWith('video/mp4') ? 'mp4' : 'webm';
        const blob = new Blob(chunks, { type: mimeType });
        resolve(new File([blob], `${label}.${ext}`, { type: mimeType }));
      };
      recorder.onerror = e => reject(e.error);

      recorder.start(100);

      let frame = 0;
      const totalFrames = 90; // 3 s at 30 fps

      function draw() {
        if (frame >= totalFrames) { recorder.stop(); return; }
        const t = frame / totalFrames;
        const idx = Math.floor(t * (colors.length - 1));
        const grad = ctx.createLinearGradient(0, 0, 480, 480);
        grad.addColorStop(0, colors[idx]);
        grad.addColorStop(1, colors[Math.min(idx + 1, colors.length - 1)]);
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, 480, 480);
        // Pulsing circle
        const radius = 80 + Math.sin(t * Math.PI * 4) * 20;
        ctx.beginPath();
        ctx.arc(240, 200, radius, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(255,255,255,0.25)';
        ctx.fill();
        // Text
        ctx.fillStyle = '#fff';
        ctx.textAlign = 'center';
        ctx.font = 'bold 36px -apple-system, sans-serif';
        ctx.fillText(platformName, 240, 310);
        ctx.font = '22px -apple-system, sans-serif';
        ctx.fillStyle = 'rgba(255,255,255,0.8)';
        ctx.fillText('Web Share API Demo', 240, 348);
        frame++;
        requestAnimationFrame(draw);
      }
      requestAnimationFrame(draw);
    });
  }

  async function generateSampleVideoMP4(label, colors, platformName) {
    if (typeof VideoEncoder === 'undefined' || typeof OffscreenCanvas === 'undefined') {
      throw new Error('WebCodecs not supported in this browser');
    }

    const { Muxer, ArrayBufferTarget } = await import(
      'https://cdn.jsdelivr.net/npm/mp4-muxer@6/build/mp4-muxer.mjs'
    );

    const width = 480, height = 480, fps = 30, totalFrames = 90;

    const target = new ArrayBufferTarget();
    const muxer = new Muxer({
      target,
      video: { codec: 'avc', width, height },
      fastStart: 'in-memory',
    });

    let encoderError = null;
    const encoder = new VideoEncoder({
      output: (chunk, meta) => muxer.addVideoChunk(chunk, meta),
      error: (e) => { encoderError = e; },
    });

    encoder.configure({
      codec: 'avc1.42001f',
      width,
      height,
      bitrate: 1_000_000,
      framerate: fps,
    });

    const canvas = new OffscreenCanvas(width, height);
    const ctx = canvas.getContext('2d');

    for (let frame = 0; frame < totalFrames; frame++) {
      const t = frame / totalFrames;
      const idx = Math.floor(t * (colors.length - 1));
      const grad = ctx.createLinearGradient(0, 0, width, height);
      grad.addColorStop(0, colors[idx]);
      grad.addColorStop(1, colors[Math.min(idx + 1, colors.length - 1)]);
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, width, height);

      const radius = 80 + Math.sin(t * Math.PI * 4) * 20;
      ctx.beginPath();
      ctx.arc(width / 2, height * 0.42, radius, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(255,255,255,0.25)';
      ctx.fill();

      ctx.fillStyle = '#fff';
      ctx.textAlign = 'center';
      ctx.font = 'bold 36px sans-serif';
      ctx.fillText(platformName, width / 2, height * 0.65);
      ctx.font = '22px sans-serif';
      ctx.fillStyle = 'rgba(255,255,255,0.8)';
      ctx.fillText('Web Share API Demo', width / 2, height * 0.725);

      const videoFrame = new VideoFrame(canvas, {
        timestamp: Math.round((frame / fps) * 1_000_000),
        duration: Math.round((1 / fps) * 1_000_000),
      });
      encoder.encode(videoFrame, { keyFrame: frame % fps === 0 });
      videoFrame.close();
    }

    await encoder.flush();
    if (encoderError) throw encoderError;
    muxer.finalize();

    return new File([target.buffer], `${label}.mp4`, { type: 'video/mp4' });
  }

  async function generateSampleVideoPreferMP4(label, colors, platformName) {
    try {
      return await generateSampleVideoMP4(label, colors, platformName);
    } catch {
      return generateSampleVideo(label, colors, platformName);
    }
  }

  async function _loadSample(btnId, previewId, storeFn, label, colors, platformName, generatorFn) {
    generatorFn = generatorFn || generateSampleVideo;
    const btn = document.getElementById(btnId);
    const preview = document.getElementById(previewId);
    btn.disabled = true;
    btn.textContent = 'Generating…';
    try {
      const file = await generatorFn(label, colors, platformName);
      storeFn(file);
      preview.src = URL.createObjectURL(file);
      preview.style.display = 'block';
      btn.textContent = '✓ Sample loaded';
    } catch (err) {
      toast('Could not generate sample: ' + err.message);
      btn.disabled = false;
      btn.innerHTML = '&#x1F3A5; Use sample video';
    }
  }

  async function loadInstagramSample() {
    const btn = document.getElementById('btn-instagram-sample');
    const videoEl = document.getElementById('instagram-video-preview');
    const imgEl = document.getElementById('instagram-img-preview');
    btn.disabled = true;
    btn.textContent = 'Loading…';
    try {
      const res = await fetch('sample-instagram.mp4');
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const blob = await res.blob();
      instagramVideoFile = new File([blob], 'sample-instagram.mp4', { type: 'video/mp4' });
      imgEl.style.display = 'none';
      videoEl.src = URL.createObjectURL(instagramVideoFile);
      videoEl.style.display = 'block';
      btn.textContent = '✓ Sample loaded';
    } catch (err) {
      toast('Could not load sample: ' + err.message);
      btn.disabled = false;
      btn.innerHTML = '&#x1F3A5; Sample video';
    }
  }

  async function loadInstagramImageSample() {
    const btn = document.getElementById('btn-instagram-img-sample');
    const imgEl = document.getElementById('instagram-img-preview');
    const videoEl = document.getElementById('instagram-video-preview');
    btn.disabled = true;
    btn.textContent = 'Generating…';
    try {
      instagramVideoFile = await generateSampleImage('instagram-sample',
        ['#f09433','#e6683c','#dc2743','#cc2366','#bc1888'], 'Instagram');
      videoEl.style.display = 'none';
      imgEl.src = URL.createObjectURL(instagramVideoFile);
      imgEl.style.display = 'block';
      btn.textContent = '✓ Sample loaded';
    } catch (err) {
      toast('Could not generate sample: ' + err.message);
      btn.disabled = false;
      btn.innerHTML = '&#x1F5BC;&#xFE0F; Sample image';
    }
  }

  function loadTikTokSample() {
    return _loadSample('btn-tiktok-sample', 'tiktok-video-preview',
      f => tiktokVideoFile = f,
      'tiktok-sample',
      ['#010101','#69c9d0','#ee1d52','#010101'],
      'TikTok',
      generateSampleVideoPreferMP4);
  }

  async function loadTikTokImageSample() {
    const btn = document.getElementById('btn-tiktok-img-sample');
    const imgEl = document.getElementById('tiktok-img-preview');
    const videoEl = document.getElementById('tiktok-video-preview');
    btn.disabled = true;
    btn.textContent = 'Generating…';
    try {
      tiktokVideoFile = await generateSampleImage('tiktok-sample',
        ['#010101','#69c9d0','#ee1d52','#010101'], 'TikTok');
      videoEl.style.display = 'none';
      imgEl.src = URL.createObjectURL(tiktokVideoFile);
      imgEl.style.display = 'block';
      btn.textContent = '✓ Sample loaded';
    } catch (err) {
      toast('Could not generate sample: ' + err.message);
      btn.disabled = false;
      btn.innerHTML = '&#x1F5BC;&#xFE0F; Sample image';
    }
  }

  function _showMediaPreview(file, imgEl, videoEl) {
    const isImage = file.type.startsWith('image/');
    imgEl.style.display = 'none'; imgEl.src = '';
    videoEl.style.display = 'none'; videoEl.src = '';
    const el = isImage ? imgEl : videoEl;
    el.src = URL.createObjectURL(file);
    el.style.display = 'block';
  }

  function onInstagramVideoSelected() {
    const file = document.getElementById('instagram-video-input').files[0];
    instagramVideoFile = file || null;
    document.getElementById('btn-instagram-sample').disabled = false;
    document.getElementById('btn-instagram-sample').innerHTML = '&#x1F3A5; Sample video';
    document.getElementById('btn-instagram-img-sample').disabled = false;
    document.getElementById('btn-instagram-img-sample').innerHTML = '&#x1F5BC;&#xFE0F; Sample image';
    const imgEl = document.getElementById('instagram-img-preview');
    const videoEl = document.getElementById('instagram-video-preview');
    if (file) {
      _showMediaPreview(file, imgEl, videoEl);
    } else {
      imgEl.style.display = 'none';
      videoEl.style.display = 'none';
    }
  }

  async function shareInstagram() {
    const { title, text, url } = getPayload();
    const file = instagramVideoFile || document.getElementById('instagram-video-input').files[0];

    if (file) {
      if (file.type.includes('webm')) {
        toast('⚠ Instagram requires MP4 — please use an MP4 file.');
        return;
      }
      if (!navigator.canShare?.({ files: [file] })) {
        toast('⚠ File sharing not supported on this device/browser.');
        return;
      }
      try {
        await navigator.share({ files: [file], title });
        toast('✓ Shared via native sheet');
      } catch (err) {
        if (err.name !== 'AbortError') toast('Share failed: ' + err.message);
      }
      return;
    }

    if ('share' in navigator) {
      navigator.share({ title, text, url })
        .then(() => toast('✓ Shared via native sheet'))
        .catch(err => { if (err.name !== 'AbortError') instagramFallback(url); });
    } else {
      instagramFallback(url);
    }
  }

  function onTikTokVideoSelected() {
    const file = document.getElementById('tiktok-video-input').files[0];
    tiktokVideoFile = file || null;
    document.getElementById('btn-tiktok-sample').disabled = false;
    document.getElementById('btn-tiktok-sample').innerHTML = '&#x1F3A5; Sample video';
    document.getElementById('btn-tiktok-img-sample').disabled = false;
    document.getElementById('btn-tiktok-img-sample').innerHTML = '&#x1F5BC;&#xFE0F; Sample image';
    const imgEl = document.getElementById('tiktok-img-preview');
    const videoEl = document.getElementById('tiktok-video-preview');
    if (file) {
      _showMediaPreview(file, imgEl, videoEl);
    } else {
      imgEl.style.display = 'none';
      videoEl.style.display = 'none';
    }
  }

  async function shareTikTok() {
    const { title, text, url } = getPayload();
    const file = tiktokVideoFile || document.getElementById('tiktok-video-input').files[0];

    if (file && navigator.canShare?.({ files: [file] })) {
      try {
        await navigator.share({ files: [file], title });
        toast('✓ Video shared via native sheet');
      } catch (err) {
        if (err.name !== 'AbortError') tiktokFallback(url);
      }
      return;
    }

    if ('share' in navigator) {
      navigator.share({ title, text, url })
        .then(() => toast('✓ Shared via native sheet'))
        .catch(err => { if (err.name !== 'AbortError') tiktokFallback(url); });
    } else {
      tiktokFallback(url);
    }
  }

  function tiktokFallback(url) {
    navigator.clipboard?.writeText(url)
      .then(() => toast('✓ Link copied — paste it in TikTok'))
      .catch(() => toast('Open TikTok and share the link manually'));
    window.open('https://www.tiktok.com/', '_blank', 'noopener,noreferrer');
  }

  function instagramFallback(url) {
    navigator.clipboard?.writeText(url)
      .then(() => toast('✓ Link copied — paste it in Instagram'))
      .catch(() => toast('Open Instagram and share the link manually'));
    window.open('https://www.instagram.com/', '_blank', 'noopener,noreferrer');
  }

  function shareEmail() {
    const { title, text, url } = getPayload();
    window.location.href = `mailto:?subject=${encodeURIComponent(title)}&body=${encodeURIComponent(text + '\n\n' + url)}`;
  }

  async function copyToClipboard() {
    const { url } = getPayload();
    try {
      await navigator.clipboard.writeText(url);
      toast('✓ Link copied to clipboard');
    } catch {
      toast('✗ Clipboard access denied');
    }
  }

  // ── Smart share ───────────────────────────────────────────────────────

  async function smartShare() {
    const menu = document.getElementById('fallback-menu');

    if ('share' in navigator) {
      menu.style.display = 'none';
      try {
        await navigator.share(getPayload());
        toast('✓ Shared via native sheet');
      } catch (err) {
        if (err.name === 'AbortError') return;
        // User cancelled or API failed — fall through to manual menu
        menu.style.display = 'block';
        toast('Native share unavailable — choose a platform below');
      }
    } else {
      menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    }
  }
</script>

</body>
</html>
